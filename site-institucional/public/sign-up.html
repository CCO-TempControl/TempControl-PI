<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CADASTRO - TempControl</title>
  <link rel="stylesheet" href="./assets/css/style.css">
  <link rel="icon" type="image/x-icon" href="./assets/img/Logo.png">
</head>
<body>
  <!-- Header -->
  <div class="header">
    <div class="container">
      <a href="./index.html">
        <img 
          src="./assets/img/logo_nome_sembg.png" 
          alt="TempControl"
        >
      </a>      
      <nav>
        <a href="./about-us.html">Quem somos</a>
        <a href="./solution.html">Solução</a>
        <a href="./calculator.html">Simulador</a>
        <a href="./contact.html">Contato</a>
        <a href="./sign-in.html">Login</a>
        <a class="here" href="">Cadastro</a>
      </nav>
    </div>
  </div>

  <!-- Cadastro -->
  <div class="banner-form alt-banner sign">
    <div class="container">
      <div class="card">
        <h2>Cadastro</h2>
        <div class="options">
          <button id="btnProducer" class="option selected" onclick="farmaceutica()">Farmacêutica</button>
          <button id="btnTransporter" class="option" onclick="transportadora()">Transportadora</button>
        </div>

        <div class="form">
          <div class="field">
            <label for="txtNome">
              Nome da Empresa:
            </label>
            <input id="txtNome" type="text" placeholder="Ex: Empresa X">
          </div>
          <div class="field">
            <label for="txtCNPJ">
              CNPJ:
            </label>
            <input id="txtCNPJ" type="text" placeholder="Ex: 87.608.614/0001-39">
          </div>
          <div id="fieldQtdEquip" class="field">
            <label for="txtQtdSensor">
              Quantidade de sensores que será comprada:
            </label>
            <input id="txtQtdSensor" type="text" placeholder="Ex: 5">
          </div>
          <div class="field">
            <label for="txtEmail">
              Email:
            </label>
            <input id="txtEmail" type="email" placeholder="Ex: seuemail@email.com">
          </div>
          <div class="field">
            <label for="txtTelefone">
              Telefone para contato:
            </label>
            <input id="txtTelefone" type="text" placeholder="Ex: 99999-8888">
          </div>
          <div class="field">
            <label for="txtSenha">
              Senha:
            </label>
            <input id="txtSenha" type="password" placeholder="Ex: **********">
          </div>
          <div class="field">
            <label for="txtConfirmaSenha">
              Confirmar senha:
            </label>
            <input id="txtConfirmaSenha" type="password" placeholder="Ex: **********">
          </div>
          <div id="divSignUpResult" class="result">            
            <p id="pMensagem">
              Olá meus senhores e minhas senhoras
            </p>
          </div>
          <button id="btnCadastro" onclick="cadastrar()">Cadastrar para orçamento</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <div class="footer">
    <div class="container">
      <div class="organizer">
        <div class="sections">
          <div class="section">
            <h4>Empresa</h4>
            <ul>
              <li>
                <a href="./about-us.html">
                  Sobre
                </a>
              </li>
              <li>
                <a href="https://github.com/CCO-TempControl" target="_blank" rel="noopener noreferrer">
                  GitHub
                </a>
              </li>
            </ul>
          </div>
          <div class="section">
            <h4>Solução</h4>
            <ul>
              <li>
                <a href="./solution.html">
                  Sobre
                </a>
              </li>
              <li>
                <a href="./calculator.html">
                  Simulador Financeiro
                </a>
              </li>
            </ul>
          </div>
          <div class="section">
            <h4>Contato</h4>
            <ul>
              <li>atendimento@tempcontrol.com</li>
              <li>+55 (11) 99999-8888</li>
            </ul>
          </div>
        </div>
        <p>
          Desenvolvido pelo Grupo 10 de PI da SPTech &copy; 2022
        </p>
      </div>
    </div>
  </div>
</body>
</html>
<script>
  var tipoEmpresa = 'farmaceutica';

  function farmaceutica() {
    btnProducer.classList.add('selected');
    btnTransporter.classList.remove('selected');
    tipoEmpresa = 'farmaceutica';
    fieldQtdEquip.style.display = 'flex';
    btnCadastro.innerHTML = 'Cadastrar para orçamento';
  }
  
  function transportadora() {
    btnTransporter.classList.add('selected');
    btnProducer.classList.remove('selected');
    tipoEmpresa = 'transportadora';
    fieldQtdEquip.style.display = 'none';
    btnCadastro.innerHTML = 'Cadastrar';
  }

  function cadastrar() {
    divSignUpResult.style.display = 'none';
    pMensagem.style.color = 'black';
    pMensagem.innerHTML = '';

    var nomeVar = txtNome.value;
    var cnpjVar = txtCNPJ.value;
    var qtdSensorVar = Number(txtQtdSensor.value);
    var emailVar = txtEmail.value;
    var telefoneVar = txtTelefone.value;
    var senhaVar = txtSenha.value;
    var confirmarSenhaVar = txtConfirmaSenha.value;

    if (
      nomeVar == '' 
      || cnpjVar == ''
      || emailVar == '' 
      || telefoneVar == ''
      || senhaVar == '' 
      || confirmarSenhaVar == ''
    ) {
      divSignUpResult.style.display = 'flex';
      pMensagem.style.color = '#fc3636';
      pMensagem.innerHTML = 'Todos os campos são obrigatórios';
      return;
    }

    if (emailVar.indexOf('@') <= 0 || emailVar.indexOf('.com') <= 2) {
      divSignUpResult.style.display = 'flex';
      pMensagem.style.color = '#fc3636';
      pMensagem.innerHTML = 'Endereço de email inválido';
      return;
    }

    if (senhaVar.length < 8) {
      divSignUpResult.style.display = 'flex';
      pMensagem.style.color = '#fc3636';
      pMensagem.innerHTML = 'A senha deve ter no minimo oito caracteres';
      return;
    }

    if (senhaVar != confirmarSenhaVar) {
      divSignUpResult.style.display = 'flex';
      pMensagem.style.color = '#fc3636';
      pMensagem.innerHTML = 'As senhas informadas devem ser iguais';
      return;
    }

    if (tipoEmpresa == 'farmaceutica') {
      if (qtdSensorVar <= 0) {
        divSignUpResult.style.display = 'flex';
        pMensagem.style.color = '#fc3636';
        pMensagem.innerHTML = 'Para usar a solução, no minímo um sensor deve ser solicitado';
        return;
      }

      fetch('/farmaceuticas/cadastrar', {
        method: 'POST',
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          nomeServer: nomeVar,
          cnpjServer: cnpjVar,
          qtdSensorServer: qtdSensorVar,
          emailServer: emailVar,
          telefoneServer: telefoneVar,
          senhaServer: senhaVar
        })
      }).then(function (response) {
        console.log('Resposta: ', response);

        if (response.ok) {
          divSignUpResult.style.display = 'flex';
          pMensagem.style.color = '#34e269';
          pMensagem.innerHTML = 'Cadastro realizado com sucesso';

          setTimeout(() => {
            window.location = './sign-in.html';
          }, 500);

        } else {
          divSignUpResult.style.display = 'flex';
          pMensagem.style.color = '#fc3636';
          pMensagem.innerHTML = 'Houve um erro ao realizar o cadastro!';
          throw ('Houve um erro ao realizar o cadastro!');
        }
      }).catch(function (response) {
        console.log(`ERRO: ${response}`);
      })

      return;
    } else {
      fetch('/transportadoras/cadastrar', {
        method: 'POST',
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          nomeServer: nomeVar,
          cnpjServer: cnpjVar,
          emailServer: emailVar,
          telefoneServer: telefoneVar,
          senhaServer: senhaVar
        })
      }).then(function (response) {
        console.log('Resposta: ', response);

        if (response.ok) {
          divSignUpResult.style.display = 'flex';
          pMensagem.style.color = '#34e269';
          pMensagem.innerHTML = 'Cadastro realizado com sucesso';

          setTimeout(() => {
            window.location = './sign-in.html';
          }, 500);

        } else {
          divSignUpResult.style.display = 'flex';
          pMensagem.style.color = '#fc3636';
          pMensagem.innerHTML = 'Houve um erro ao realizar o cadastro!';
          throw ('Houve um erro ao realizar o cadastro!');
        }
      }).catch(function (response) {
        divSignUpResult.style.display = 'flex';
        pMensagem.style.color = '#fc3636';
        pMensagem.innerHTML = 'Houve um erro ao realizar o cadastro!';
        console.log(`ERRO: ${response}`);
      });

      return;
    }
  }
</script>
